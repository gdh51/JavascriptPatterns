# 基本技巧

## 编写可维护的代码
+ bug修改需要成本且随项目总成本增加增加
+ 阅读比写代码更耗时间

易维护的代码意味具有如下特性：
+ 阅读性好
+ 具有一致性
+ 预见性好
+ 仿佛如一人编写
+ 有文档说明

## 尽量少用全局变量
**问题**：污染全局命名空间，当共同定义相同名字时会发生冲突。

在函数内定义变量只有函数内可以访问。在函数外部声明(最顶层作用域)的变量会作为属性定义在顶层作用域(window对象)上。

**解决方法**：用自执行函数包裹书写。

以下代码也会在不经意间定义全局变量：
```js
function def(){
  var a=b=0;//由于操作符优先级是从右向左，所以会先执行b=0，导致定义全局变量b
  //等价于
  var a=(b=0);
}
```

### 变量释放时的副作用
隐式定义的全局变量和明确定义的全局变量的不同在于是否能使用delete操作符删除变量。
+ 显式：使用var定义**不能**删除(最顶层作用域)
+ 隐式：不使用var定义**可以**删除

### 访问全局对象
非严格模式下，严格模式为undefined
```js
var global = (function (){
  return this;//顶层作用域域中由全局对象调用
})();
```

### 单一var模式(Single var Pattern)
在函数顶部只使用一个var进行所有的局部变量声明，优点：
+ 方便查找所有的局部变量
+ 防止变量提升带来的逻辑错误
+ 避免使用全局变量
+ 更少的编码

## for循环
+ 使用最少的变量
  for循环对dom操作时，保存dom长度，以免每次循环时检查循环条件时进行一次查询。
  ```js
  for (var i = 0; i < domArray.length; i++){
    //一些操作
  }
  //避免每次查询，下面改进
  for (var i = 0, max = domArray.length; i < max; i++){
    //一些操作
  }
  ```
+ 逐步减至0。(同0比较 比 同数组长度比较 或 同非0数组比较更有效率)
  ```js
  //改进上面的for循环
  for (var max = domArray.length; max--;){
    //一些操作
  }
  ```

## 不增加内置对象的原型
增加内置构造函数的原型会影响可维护性。但以下情形除外：
1. 未来ES版本具体实现了该功能作为一个同意的内置方法，可以提前定义(使用能力检查判断)
2. 该浏览器有其他浏览器还不支持
3. 用准确的文档记录，与团队交流

```js
Object.prototype.myMethod = NativeMethod || function (){
  //自定义方法
}
```

## switch模式
用以下模式来提高switch语句的可读性和健壮性
+ case与switch纵向排列整齐
+ 每个case使用代码缩进
+ 每个case语句结尾有明确的break语句
+ 避免使用fall-throughs(故意不用break语句使程序一直向下执行，这样会在其他人阅读时产生有错误的误会)
+ 用default结束switch

## 避免使用隐式类型转换
使用比较语句会运算符时有时会进行隐式转换，所以在比较语句时尽量使用===和!===操作符进行比较

### 避免使用eval()
使用eval()包含一些安全隐患，可能会执行被篡改过的代码
+ 不用来处理Ajax请求的JSON响应，最好使用内置的JSON方法或使用网上的JSON类库
+ 不用通过setIntervall()、setTimeout()、function()等构造函数来传递参数(类似eval隐患)
  ```js
  //反模式
  setTimeout('myFunc()',1000);
  setTimeout('myFunc(1,2,3)',1000);
  ```
一定要使用eval()时可以考虑用new Function()来代替，好处是由于在new Function()中的代码将在局部函数空间中运行，当然页可以将eval()封装到一个自执行函数中;其次eval()可以访问和修改它外部作用域的变量，而Function不行。
```js
var jsstring='var un=1;console.log(un);';
eval(jsstring);
console.log(un);//  1

new Function(jsstring)();
console.log(un);//Uncaught Error
```

## 编码约定
遵循编码约定，使代码更为一致、可预测、更容易阅读和理解

### 缩进
JSLint默认用4个空格来缩进，主要包括：函数体、循环体、if语句、switch语句和对象字面量的引用。

### 大括号
在可以选用大括号时，使用大括号。且大括号的前部分应该与前面的语句同一行
```js
if (){
  //.......
}
```

### 空格
使用空格有助于改善代码的可读性和一致性，较好的位置包含：
+ f每个 ; 后
+ 连续用 , 分隔的值后
+ 大括号 { 前
+ 各种操作符前后,如+,-

## 命名约定
+ 构造函数首字母大写
+ 分隔单词,利用 _ 或 驼峰式书写法,如firstNum或first_num
+ 全大写命名表示常量
+ 以 _ 开头的变量表示私有成员变量

## 编写API文档(可跳过)
生成API文档的步骤：
+ 编写特殊格式的代码块
+ 运行工具来解析代码和注释
+ 发布工具解析的结果，大多数情况是采用HTML格式发布

```js
//文档记录的格式如下
/**
*@tag value
**/

//例如一个函数
/**
*
*@param {String}  输入参数
*@return {String} 输出结果
**/
//表示如下函数
function (input){
  return output;
}
```
还有其他标签：
+ @namespace：用于命名包含以上对象的全局引用的名称
+ @class：指对象或者构造函数
+ @method：定义对象方法和方法名
+ @param：列举函数使用的参数。参数用{}包裹，并在后面注释参数及描述
+ @return：描述函数的返回值

## 正式发布精简代码
减少空白位置、注释和其他代码不重要的部分，通常采用工具进行。